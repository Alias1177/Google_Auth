name: Deploy Google_Auth

on:
  push:
    branches:
      - main     # üëà –∫–æ–≥–¥–∞ –º—ã –ø—É—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –≤–µ—Ç–∫—É main ‚úÖ

jobs:
  deploy:
    runs-on: ubuntu-latest   # –°–∏—Å—Ç–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∑–∞–¥–∞—á (–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä ubuntu –æ—Ç GitHub)

    steps:
      - name: üõéÔ∏è Checkout code
        uses: actions/checkout@v4
        # üìå –≠—Ç–æ—Ç —à–∞–≥ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

      - name: üîë Setup SSH Agent
        uses: webfactory/ssh-agent@v0.10.1
        with:
          ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}
        # üìå –≠—Ç–æ—Ç —à–∞–≥ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç SSH-–∞–≥–µ–Ω—Ç –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ SSH-–∫–ª—é—á–∞ –Ω–∞–ø—Ä—è–º—É—é –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (–∫–ª—é—á –±–µ—Ä—ë–º –∏–∑ —Å–µ–∫—Ä–µ—Ç–∞, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –Ω–∞ GitHub).

      - name: üöÄ Deploy to Server
        run: |
          ssh -o StrictHostKeyChecking=no ${{ secrets.SERVER_USER }}@${{ secrets.SERVER_IP }} << EOF
            # üëá –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
            cd ~/Google_Auth

            # üëá –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å GitHub
            git pull origin main
          
            # üëá –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ docker-compose
            docker-compose down
            docker-compose up -d --build
          EOF